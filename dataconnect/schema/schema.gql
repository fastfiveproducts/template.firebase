#
#  schema.gql
#
#  Created by Pete Maiser, Fast Five Products LLC.
#      Template v0.2.x — Fast Five Products LLC's public AGPL template.
#
#  Copyright © 2025, 2026 Fast Five Products LLC. All rights reserved.
#
#  This file is part of a project licensed under the GNU Affero General Public License v3.0.
#  See the LICENSE file at the root of this repository for full terms.
#
#  An exception applies: Fast Five Products LLC retains the right to use this code and
#  derivative works in proprietary software without being subject to the AGPL terms.
#  See LICENSE-EXCEPTIONS.md for details.
#
#  For licensing inquiries, contact: licenses@fastfiveproducts.llc
#

###################################################################
# User

type UserAccount @table(key: ["id"]) {
    id: String! @default(expr: "auth.uid")
    createTimestamp: Timestamp! @default(expr: "request.time")
    createDeviceIdentifierstamp: String!
    createDeviceTimestamp: String!
    updateTimestamp: Timestamp
    updateDeviceIdentifierstamp: String
    updateDeviceTimestamp: String
    displayNameText: String!
    displayNameTextLower: String
    photoUrl: String!
}

type UserDisplayName @table(key: ["text"]) {
    text: String!
    createUser: UserAccount!
    createTimestamp: Timestamp! @default(expr: "request.time")
    setTimestamp: Timestamp
    setDeviceIdentifierstamp: String
    setDeviceTimestamp: String
}


###################################################################
# User Demographic Profile
# A User Demographic Profile for a particular user can be changed
# by inserting a new row.

type UserDemographicProfile @table {
    id: UUID! @default(expr: "uuidV4()")
    createUser: UserAccount!
    createTimestamp: Timestamp! @default(expr: "request.time")
    createDeviceIdentifierstamp: String!
    createDeviceTimestamp: String!
    gender: DemographicsGender!
    generation: DemographicsGeneration!
    region: DemographicsRegion!
    urbanicity: DemographicsUrbanicity!
    political: DemographicsPolitical!
}


###################################################################
# Cross-User Relationships
# User Relationships can be changed by inserting a new row.

type UserAssociation @table {
    id: UUID! @default(expr: "uuidV4()")
    createUser: UserAccount!
    associateUserId: String! @index
    associateUserDisplayNameText: String!
    createTimestamp: Timestamp! @default(expr: "request.time")
    createDeviceIdentifierstamp: String!
    createDeviceTimestamp: String!
    follow: Boolean! @default(value: false)
    block: Boolean! @default(value: false)
    autoSharePrivateContent: Boolean! @default(value: false)
}


###################################################################
# User Comments, User Messages

type PublicComment @table {
    id: UUID! @default(expr: "uuidV4()")
    createUser: UserAccount!
    toUserId: String
    toUserDisplayNameText: String
    createTimestamp: Timestamp! @default(expr: "request.time")
    createDeviceIdentifierstamp: String!
    createDeviceTimestamp: String!
    title: String!
    content: String!
}


type PrivateMessage @table {
    id: UUID! @default(expr: "uuidV4()")
    createUser: UserAccount!
    toUserId: String
    toUserDisplayNameText: String
    createTimestamp: Timestamp! @default(expr: "request.time")
    createDeviceIdentifierstamp: String!
    createDeviceTimestamp: String!
    title: String!
    content: String!
}

type PublicCommentReference @table(
    key: ["publicComment", "referenceId"]
) {
    publicComment: PublicComment!
    referenceId: UUID! @index
    createUser: UserAccount!
    createTimestamp: Timestamp! @default(expr: "request.time")
}

type PrivateMessageReference @table(
    key: ["privateMessage", "referenceId"]
) {
    privateMessage: PrivateMessage!
    referenceId: UUID! @index
    createUser: UserAccount!
    createTimestamp: Timestamp! @default(expr: "request.time")
}

type PrivateMessageStatus @table {
    id: UUID! @default(expr: "uuidV4()")
    privateMessage: PrivateMessage!
    createUser: UserAccount!
    createTimestamp: Timestamp! @default(expr: "request.time")
    status: String!     # expected values "draft", "sent", "read", "archived", "deleted"
}


###################################################################
# Demographic Values

type DemographicsGender @table(
    key: ["key"]
) {
    key: String! @unique
    name: String!
    description: String!
    photoUrl: String
}

type DemographicsGeneration @table(
    key: ["key"]
) {
    key: String! @unique
    name: String!
    description: String!
    birthYearStart: Int!
    birthYearEnd: Int!
    photoUrl: String
}

type DemographicsRegion @table(
    key: ["key"]
) {
    key: String! @unique
    name: String!
    description: String!
    photoUrl: String
}

type DemographicsUrbanicity @table(
    key: ["key"]
) {
    key: String! @unique
    name: String!
    description: String!
    photoUrl: String
}

type DemographicsPolitical @table(
    key: ["key"]
) {
    key: String! @unique
    name: String!
    description: String!
    photoUrl: String
}


###################################################################
# RestrictedWord
type RestrictedWord @table(
    key: ["word"]
) {
    word: String!
}


###################################################################
# HelpText
type HelpText @table(
    key: ["code"]
) {
    code: String!
    text: String!
}
