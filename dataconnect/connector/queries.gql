
###################################################################
# Current User 

query GetMyUserAccount @auth(
    level: USER
) {
    userAccounts(
        where: { id: { eq_expr: "auth.uid" } }
        orderBy: { createTimestamp: DESC }
        limit: 1
    ) {
        id
        displayNameText
        photoUrl
    }
}

query GetMyDisplayNames @auth(
    level: USER
) {
    userDisplayNames(
        where: { createUser: { id: { eq_expr: "auth.uid" } } }
        orderBy: { setTimestamp: DESC }
    ) {
        text
        createTimestamp
        setTimestamp
    }
}


###################################################################
# User Demographic Profile
# A User Demographic Profile for a particular user can be changed
# by inserting a new row.

query GetMyUserDemographicProfile @auth(
    level: USER
) {
    userDemographicProfiles(
        where: { createUserId: { eq_expr: "auth.uid" } }
        orderBy: { createTimestamp: DESC }
        limit: 1
    ) {
        createTimestamp
        gender {
            key
            name
            description
            photoUrl
        }
        generation {
            key
            name
            description
            birthYearStart
            birthYearEnd
            photoUrl
        }
        region {
            key
            name
            description
            photoUrl
        }
        urbanicity {
            key
            name
            description
            photoUrl
        }
        political {
            key
            name
            description
            photoUrl
        }
    }
}


###################################################################
# Cross-User Relationships
# User Relationships can be changed by inserting a new row.

query GetMyUserAssociations @auth(
    level: USER_EMAIL_VERIFIED
) {
    userAssociations (
        where: { createUserId: { eq_expr: "auth.uid" } }
        orderBy: [
            { associateUserId: ASC }
            { createTimestamp: DESC }
        ]
    ){
        associateUserId
        associateUserDisplayNameText
        createTimestamp
        follow
        block
        autoSharePrivateContent
    }
}


###################################################################
# General User 

query GetUserAccount(
    $userId: String!
) @auth(
    level: USER_EMAIL_VERIFIED
    insecureReason: "some user profile details are meant to be visible to all authenticated users"
) {
    userAccounts(
        where: { id: { eq: $userId } }
        orderBy: { createTimestamp: DESC }
        limit: 1
    ) {
        id
        displayNameText
        photoUrl
    }
}

query UserDisplayNameSearch(
    $searchText: String!
    $limit: Int!
) @auth(
    level: USER
    # level: USER_EMAIL_VERIFIED
    insecureReason: "user search is needed for messaging functionality"
) {
    userAccounts(
        where: { displayNameTextLower: { contains: $searchText } }
        orderBy: { displayNameText: ASC }
        limit: $limit
    ) {
        id
        displayNameText
        photoUrl
    }
}


###################################################################
# User Comments, User Messages

query ListPublicComments(
    $limit: Int!
) @auth(
    level: USER
    insecureReason: "public comments are meant to be visible to all authenticated users"
) {
    publicComments(
        orderBy: { createTimestamp: DESC }
        limit: $limit
    ) {
        id
        createTimestamp
        createUser {
            id
            displayNameText
            photoUrl
        }
        toUserId
        toUserDisplayNameText
        title
        content
    }
}

query GetMyPrivateMessages(
    $limit: Int!
) @auth(
    level: USER
    # level: USER_EMAIL_VERIFIED
) {
    privateMessages(
        where: {
            _or: [
                    { createUserId: { eq_expr: "auth.uid" } }
                    { toUserId: { eq_expr: "auth.uid" } }
             ] }
        orderBy: { createTimestamp: DESC }
        limit: $limit
    ) {
        id
        createTimestamp
        createUser {
            id
            displayNameText
            photoUrl
        }
        toUserId
        toUserDisplayNameText
        title
        content
    }
}

query GetPublicCommentReferences(
    $commentId: UUID!
    $limit: Int!
) @auth(
    level: USER
    insecureReason: "public comments are meant to be visible to all authenticated users"
) {
    publicCommentReferences(
        where: { publicCommentId: { eq: $commentId } }
        orderBy: [
            { publicComment: { createTimestamp: DESC } }
            { createTimestamp: DESC }
        ]
        limit: $limit
    ) {
        publicCommentId
        referenceId
    }
}

query GetMyPrivateMessageReferences(
    $limit: Int!
) @auth(
    level: USER_EMAIL_VERIFIED
) {
  privateMessageReferences(
    where: {
        privateMessage: {
            _or: [
                    { createUserId: { eq_expr: "auth.uid" } }
                    { toUserId: { eq_expr: "auth.uid" } }
                ] }
        }
        orderBy: [
            { privateMessage: { createTimestamp: DESC } }
            { createTimestamp: DESC }
        ]
        limit: $limit
    ) {
        privateMessageId
        referenceId
    }
}

query GetPrivateMessageReferences(
    $messageId: UUID!
    $limit: Int!
) @auth(
    level: USER_EMAIL_VERIFIED
) {
  privateMessageReferences(
    where: {
        privateMessage: {
            _and: [
                { id: { eq: $messageId } }
                {
                    _or: [
                        { createUserId: { eq_expr: "auth.uid" } }
                        { toUserId: { eq_expr: "auth.uid" } }
                    ]
                }
            ] }
        }
        orderBy: {createTimestamp: DESC}
        limit: $limit
    ) {
        privateMessageId
        referenceId
    }
}

query GetMyPrivateMessageStatus(
    $limit: Int!
) @auth(
    level: USER_EMAIL_VERIFIED
) {
  privateMessageStatuses(
    where: {
        privateMessage: {
            _or: [
                    { createUserId: { eq_expr: "auth.uid" } }
                    { toUserId: { eq_expr: "auth.uid" } }
                ] }
        }
        orderBy: [
            { privateMessage: { createTimestamp: DESC } }
            { createTimestamp: DESC }
        ]
        limit: $limit
    ) {
        privateMessageId
        createUserId
        createTimestamp
        status
    }
}

query GetPrivateMessageStatus(
    $messageId: UUID!
    $limit: Int!
) @auth(
    level: USER_EMAIL_VERIFIED
    insecureReason: "users need to see status of messages they received (created by others)"
) {
  privateMessageStatuses(
    where: { privateMessage: { id: { eq: $messageId } } }
    orderBy: { createTimestamp: DESC }
    limit: $limit
    ) {
        createUserId
        createTimestamp
        status
    }
}


###################################################################
# Demographic Values

query ListDemographicsGender @auth(
    level: USER
    insecureReason: "demographics are meant to be visible to all authenticated users"
) {
    demographicsGenders(
        orderBy: { key: ASC }
    ) {
        key
        name
        description
        photoUrl
    }
}

query ListDemographicsGeneration @auth(
    level: USER
    insecureReason: "demographics are meant to be visible to all authenticated users"
) {
    demographicsGenerations(
        orderBy: { key: ASC }
    ) {
        key
        name
        description
        birthYearStart
        birthYearEnd
        photoUrl
    }
}

query ListDemographicsRegion @auth(
    level: USER
    insecureReason: "demographics are meant to be visible to all authenticated users"
) {
    demographicsRegions(
        orderBy: { key: ASC }
    ) {
        key
        name
        description
        photoUrl
    }
}

query ListDemographicsUrbanicity @auth(
    level: USER
    insecureReason: "demographics are meant to be visible to all authenticated users"
) {
    demographicsUrbanicities(
        orderBy: { key: ASC }
    ) {
        key
        name
        description
        photoUrl
    }
}

query ListDemographicsPolitical @auth(
    level: USER
    insecureReason: "demographics are meant to be visible to all authenticated users"
) {
    demographicsPoliticals(
        orderBy: { key: ASC }
    ) {
        key
        name
        description
        photoUrl
    }
}


###################################################################
# RestrictedWord
query ListRestrictedWords(
    $limit: Int!
) @auth(
    level: PUBLIC
    insecureReason: "restricted words are static reference data used for input validation"
) {
    restrictedWords(
        orderBy: { word: ASC }
        limit: $limit
    ) {
        word
    }
}


###################################################################
# HelpText
query ListHelpText(
    $limit: Int!
) @auth(
    level: PUBLIC
    insecureReason: "help text is static, user-facing content"
) {
    helpTexts(
        orderBy: { code: ASC }
        limit: $limit
    ) {
        code
        text
    } 
}