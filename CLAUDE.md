# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this Firebase Data Connect project.


## Build Commands
```bash
# Check schema changes against deployed database
firebase dataconnect:sql:diff

# Regenerate Swift connector code after schema/query/mutation changes
firebase dataconnect:sdk:generate
```

## Architecture

This is a template app of a Firebase backend using Data Connect (PostgreSQL)

### Project Structure
- ./ - this project, firebase Data Connect schema, queries, and mutations
- ../dataconnect-generated/ — Auto-generated Swift connectors (read-only)
- ../{other projects} - client apps


## Schema

Key tables in `dataconnect/schema/schema.gql`:
- `UserAccount` — User profiles keyed by Firebase Auth UID
- `UserDisplayName` — Unique display names (separate table for uniqueness enforcement)
- `UserDemographicProfile` — Append-only demographics (latest row = current)
- `UserAssociation` — Follow/block relationships between users
- `PublicComment` / `PrivateMessage` — User-generated content with reference and status tracking


## Do Not Modify
- `../dataconnect-generated/` — Regenerated by `firebase dataconnect:sdk:generate`
- To change Data Connect behavior, modify `schema.gql`, `queries.gql`, or `mutations.gql` — not the generated connectors


## Code Review

When asked to "do a code review", follow this process:

### Categories to Evaluate
1. **Bugs** — Logic errors, copy-paste mistakes, typos in code
2. **Security** — Auth gaps, data exposure, input validation, secrets in source control
3. **Error Handling** — Unhandled throws, force unwraps, silent failures, missing edge cases
4. **Deprecated APIs** — Use of deprecated Firebase functions
5. **Performance** — Redundant computation, missing caching, unbounded queries, expensive operations
6. **Style** — Inconsistencies with the rest of the existing codebase
7. **Licensing** — Attribution, copyright headers, commercial risks

### Output Format
Present findings as a numbered table with columns: ID, Category, Priority, Summary, and File(s). Use short IDs (e.g. B1, S1, E1, D1, P1, C1, L1) by category. Prioritize bugs and security issues first.

### Workflow
1. Explore the repo thoroughly, then present the full findings table
2. Discuss each finding with the user — they will decide to fix, close, or defer each one
3. For each fix: edit → build → commit → push
4. After each commit, regenerate the tracking table with updated statuses
5. Use `pbcopy` (with `sed 's/[[:space:]]*$//'`) when asked to copy tables to clipboard


## Testing
- Manual testing only (no automated test suite)


## Workflow
1. Claude: modify schema, queries, or mutations in `dataconnect/`
2. Claude: run `firebase dataconnect:sdk:generate` to check for errors
3. Claude: fix errors and repeat
4. Human:  reviews changes and deploys with CLI
5. Git Workflow: Feature branches from `develop`, squash-merge to `develop`, then squash to `main` for releases


## Common Issues
- **Schema migration conflicts**: Check deployed mutations before removing tables
- **Firebase auth required**: Run `firebase login` if commands fail with auth errors
- **Generated code errors**: Never edit files in `dataconnect-generated/`; fix the source schema/queries instead
